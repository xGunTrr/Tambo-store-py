{% extends "index.html" %}

{% block content %}
<div class="main-reports">  
    <div class="report-container">
        <div class="report-header">
            <h2 class="report-title">Productos</h2>
        </div>
        <!-- üîç Buscador -->
        <div class="buscador-container">
            <form method="POST" action="{{ url_for('product_bp.listar_productos') }}" style="display: flex; gap: 10px;">
                <input type="text" name="query" placeholder="Buscar producto..." value="{{ request.form.get('query', '') }}">
                <button type="submit">Buscar</button>
                <a href="{{ url_for('product_bp.listar_productos') }}" class="reset-btn">Reset</a>
                <button type="button" class="agregar-btn" data-bs-toggle="modal" data-bs-target="#modalAgregarProducto">Agregar producto</button>
            </form>
        </div>


        <div class="report-body">
            <div class="report-topic-heading">
                <h3 class="t-op">C√≥digo</h3>
                <h3 class="t-op">Nombre de Producto</h3>
                <h3 class="t-op">Categor√≠a</h3>
                <h3 class="t-op">Subcategor√≠a</h3>
                <h3 class="t-op">Precio</h3>
                <h3 class="t-op">Stock</h3>
                <h3 class="t-op">Editar</h3>
                <h3 class="t-op">Eliminar</h3>
            </div>

            <div class="items">
                {% for p in productos %}
                <div class="item">
                    <h3 class="t-op-nextlvl">{{ p.id }}</h3>
                    <h3 class="t-op-nextlvl">{{ p.nombre_producto }}</h3>
                    <h3 class="t-op-nextlvl">{{ p.id_categoria }}</h3>
                    <h3 class="t-op-nextlvl">{{ p.id_subcategoria }}</h3>
                    <h3 class="t-op-nextlvl">S/.{{ p.precio }}</h3>
                    <h3 class="t-op-nextlvl">
                        {% if p.stock is none %}
                            0 und.
                        {% else %}
                            {{ p.stock }} und.
                        {% endif %}
                    </h3>
                    <h3 class="t-op-nextlvl">
                        <button type="button" class="btn-submit input-pedidos btn-editar-producto" 
                            data-id="{{ p.id }}" 
                            data-nombre="{{ p.nombre_producto }}" 
                            data-categoria="{{ p.id_categoria }}" 
                            data-subcategoria="{{ p.id_subcategoria }}" 
                            data-precio="{{ p.precio }}" 
                            data-stock="{{ p.stock if p.stock else 0 }}">
                            Editar
                        </button>
                    </h3>
                    <form action="{{ url_for('product_bp.eliminar_producto', id_producto=p.id) }}" method="POST" style="display:inline;">
                        <button type="submit" class="btn-submit input-pedidos btn-eliminar" onclick="return confirm('¬øEst√°s seguro de que deseas eliminar este producto?')">
                            Eliminar
                        </button>
                    </form>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
<!-- Modal Agregar Producto -->
<div id="modalAgregarProducto" class="modal">
    <div class="modal-content">
        <span class="close-btn" id="closeModal">&times;</span>
        <h2>Agregar Producto</h2>
        <form method="POST" action="{{ url_for('product_bp.agregar_producto') }}">
        <div class="form-group">
            <label for="nombre">Nombre:</label>
            <input type="text" id="nombre" name="nombre_producto" required>
        </div>
        <div class="form-group">
            <label for="categoria">Categor√≠a:</label>
            <select id="categoria" name="id_categoria" required>
                <option value="">Selecciona una categor√≠a</option>
                {% for c in categorias %}
                <option value="{{ c.id }}">{{ c.nombre_categoria}}</option>
                {% endfor %}
            </select>
            </div>

            <div class="form-group">
            <label for="subcategoria">Subcategor√≠a:</label>
            <select id="subcategoria" name="id_subcategoria" required>
                <option value="">Selecciona una subcategor√≠a</option>
                {% for s in subcategorias %}
                <option value="{{ s.id }}">{{ s.nombre_subcategoria}}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="precio">Precio:</label>
            <input type="number" id="precio" name="precio" step="0.01" required>
        </div>
        <div class="form-group">
            <label for="stock">Stock:</label>
            <input type="number" id="stock" name="stock" required>
        </div>
        <button type="submit" class="btn-submit">Guardar</button>
        </form>
    </div>
</div>

<!-- Modal Editar Producto -->
<div id="modalEditarProducto" class="modal">
    <div class="modal-content">
        <span class="close-btn" id="closeModalEditar">&times;</span>
        <h2>Editar Producto</h2>
        <form method="POST" action="{{ url_for('product_bp.editar_producto') }}">
        <input type="hidden" id="edit_id" name="id_producto">
        <div class="form-group">
            <label for="edit_nombre">Nombre:</label>
            <input type="text" id="edit_nombre" name="nombre_producto" required>
        </div>
        <div class="form-group">
            <label for="edit_categoria">Categor√≠a:</label>
            <select id="edit_categoria" name="id_categoria" required>
                <option value="">Selecciona una categor√≠a</option>
                {% for c in categorias %}
                <option value="{{ c.id }}">{{ c.nombre_categoria}}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="edit_subcategoria">Subcategor√≠a:</label>
            <select id="edit_subcategoria" name="id_subcategoria" required>
                <option value="">Selecciona una subcategor√≠a</option>
                {% for s in subcategorias %}
                <option value="{{ s.id }}">{{ s.nombre_subcategoria}}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="edit_precio">Precio:</label>
            <input type="number" id="edit_precio" name="precio" step="0.01" required>
        </div>
        <div class="form-group">
            <label for="edit_stock">Stock:</label>
            <input type="number" id="edit_stock" name="stock" required>
        </div>
        <button type="submit" class="btn-submit">Actualizar</button>
        </form>
    </div>
</div>

<script src="{{ url_for('static', filename='js/modal.js') }}"></script>
{% endblock %}

